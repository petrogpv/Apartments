<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <script src="http://code.jquery.com/ui/1.10.1/jquery-ui.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>

<style>
    td, th {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -html-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        cursor: default

    }
    td {
        height: 40px;
        width: 50px;
        text-align: center;
        vertical-align: top;
        padding-top: 10px;
    }
</style>

<script>
    function onload() {
        var tds = document.getElementsByTagName("td");
        for(var i = 0; i < tds.length; i++) {
            tds[i].onclick =
                    function(td) {
                        return function() {
                            tdOnclick(td);
                        };
                    }(tds[i]);
        }
        var inputs = document.getElementsByTagName("input");
        for(var i = 0; i < inputs.length; i++) {
            inputs[i].onclick =
                    function(input){
                        return function() {
                            inputOnclick(input);
                        };
                    }(inputs[i]);
        }
    }
    function tdOnclick(td) {
        for(var i = 0; i < td.childNodes.length; i++) {
            if(td.childNodes[i].nodeType == 1) {
                if(td.childNodes[i].nodeName == "INPUT") {
                    if(td.childNodes[i].checked) {
                        td.childNodes[i].checked = false;
                        td.style.backgroundColor = "transparent";
                    } else {
                        td.childNodes[i].checked = true;
                        td.style.backgroundColor = "#a2ff41";
                    }
                } else {
                    tdOnclick(td.childNodes[i]);
                }
            }
        }
    }
    function inputOnclick(input) {
        input.checked = !input.checked;
        return false;
    }

    function calendar() {
        var monthNames = "JanFebMarAprMayJunJulAugSepOctNovDec";
        var date = new Date(${date});

        year =  date.getYear();
        if (year < 2000)
            year = year + 1900;
        nDays = date.getDate();
        firstDay = date;
        firstDay.setDate(1);
//        testMe = firstDay.getDate();
//        if (testMe == 2)
//            firstDay.setDate(0);
        startDay = firstDay.getDay();
        startDay --;
        if (startDay < 0) startDay = 6;
        document.writeln("<div align = 'center'>");

        <%--document.write("<style>"+--%>
        <%--"td, th {"+--%>
        <%--"-webkit-touch-callout: none;"+--%>
        <%--"-webkit-user-select: none;"+--%>
        <%--" -html-user-select: none;"+--%>
        <%--"-moz-user-select: none;"+--%>
        <%--"-ms-user-select: none;"+--%>
        <%--"user-select: none;"+--%>
        <%--"vcursor: default"+--%>
        <%--"}"+--%>
        <%--"td {"+--%>
        <%--" height: 40px;"+--%>
        <%--" width: 50px;"+--%>
        <%--"text-align: center;"+--%>
        <%--"vertical-align: top;"+--%>
        <%--" padding-top: 10px;"+--%>
        <%--"}"+--%>
        <%--"</style>");--%>

        <%--document.write("<h3>Pricing template upload for ${monthString} ${year}</h3> <form action='/pricing_upload' method='post'> " +--%>
        <%--"<h5>Default pricing model - all days in month will be priced by Type 1 prices. Choose options below to change pricing model.</h5> " +--%>
        <%--"<input type='checkbox' name='weekends' value='1'>Weekends pricing by Type 2 prices<Br> " +--%>
        <%--"<p>Choose holidays pricing by Type 3 or leave blank:</p>" +--%>
        <%--"<input type='hidden' name='year' value=${year}>" +--%>
        <%--"<input type='hidden' name='month' value=${month}>");--%>


        document.write("<table border = '3'>" );
        document.write("<tr> <th>Mon <th>Tue <th>Wed " +
                "<th>Thu <th>Fri <th><span style='color: red'> Sat</span> " +
                "<th><span style='color: red'> Sun</span>" );
        document.write("<tr>");

        column = 0;

        for (i = 0; i < startDay; i++) {
            document.write("<td>");
            column++;
        }
        for (i = 1; i <= nDays; i++) {
            document.write("<td>");
            document.write(i+"<br>");
            document.write("<input type='checkbox' style='opacity:0; position:absolute;' name='free' value='" + i + "'>");

            column++;
            if (column == 7) {
                document.write("<tr>");
                column = 0;
            }
        }
        if (column !=7){
            while (column < 7) {
                document.write("<td>");
                column++;
            }
        }
        document.write("</table>");
        document.writeln("</div>");
//                        document.write("<p><input type='submit' value='Confirm'></p>" +
//                                "  </form>");
    }
</script>

<div class="container">
<c:choose>
        <c:when test="${check ne 0}">
            <h3>The month pricing for ${monthString} ${year} is alredy exist. Choose other month...</h3>
        </c:when>
        <c:otherwise>
            <h3>Pricing template upload for ${monthString} ${year}</h3>

            <form action="/pricing_upload" method="post">
                <h5>Default pricing model - all days in month will be priced by Type 1 prices. Choose options below to change pricing model.</h5>
                <input type="checkbox" name="weekends" value="1">Weekends pricing by Type 2 prices<Br>
                <p>Choose holidays pricing by Type 3 or leave blank:</p>

                <input type="hidden" name="year" value=${year}>
                <input type="hidden" name="month" value=${month}>

                    <script>
                    calendar();

                    $(function()
                    {
                        onload();
                    });
                </script>
                <p><input type="submit" value="Confirm"></p>
            </form>

        </c:otherwise>
    </c:choose>
</div>